<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LDAP Inventory guide &mdash; Ansible Community Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=5707b69d" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/ansible.css?v=c5b67dd2" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/antsibull-minimal.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/rtd-ethical-ads.css?v=289b023e" />

  
    <link rel="shortcut icon" href="../../../../_static/images/Ansible-Mark-RGB_Black.png"/>
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/collections/microsoft/ad/docsite/guide_ldap_inventory.html"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=c7b8e248"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Setting list option values guide" href="guide_list_values.html" />
    <link rel="prev" title="LDAP Connection guide" href="guide_ldap_connection.html" /><!-- extra head elements for Ansible beyond RTD Sphinx Theme -->
<script src="https://www.redhat.com/dtm.js"></script>


<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="devel">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->



<script>
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','https://s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

</head>

<body class="wy-body-for-nav"><!-- extra body elements for Ansible beyond RTD Sphinx Theme -->
<!-- Google Tag Manager -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

<div class="DocSite-globalNav ansibleNav">
  <ul>
    <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
    <li><a href="https://forum.ansible.com/" target="_blank">Ansible community forum</a></li>
    <li><a href="https://docs.ansible.com/" target="_blank">Documentation</a></li>
  </ul>
</div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../../../../_static/images/Ansible-Mark-RGB_White.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">Ansible Community Documentation</div>
</a>
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Ansible
          </a>
              <div class="version">
                devel
              </div><!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <form class="version-dropdown" method="get">
      <script>
        function switchVersionTo(slug) {
          var current_url_path = window.location.pathname;
          var url_version = current_url_path.search("/devel/") > -1
            ? "/devel/"
            : "/latest/";
          var new_version_url = current_url_path.replace(url_version, "/" + slug + "/");
          window.location.replace(new_version_url);
        }
      </script>
      <label class="sr-only" for="version-list">Select version:</label>
      <select
          class="version-list"
          id="version-list"
          onchange="switchVersionTo(this.value);"
      >
        
        <option
            value="latest"
            
        >
            latest
        </option>
        
        <option
            value="9"
            
        >
            9
        </option>
        
        <option
            value="2.9"
            
        >
            2.9
        </option>
        
        <option
            value="devel"
            selected="selected"
        >
            devel
        </option>
        
      </select>
    </form>
  
</div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" method="get">
    <label class="sr-only" for="q">Search docs:</label>
    <input type="text" class="st-default-search-input" id="q" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Ansible getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started/index.html">Getting started with Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started_ee/index.html">Getting started with Execution Environments</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../inventory_guide/index.html">Building Ansible inventories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../command_guide/index.html">Using Ansible command line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../playbook_guide/index.html">Using Ansible playbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../vault_guide/index.html">Protecting sensitive data with Ansible vault</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../module_plugin_guide/index.html">Using Ansible modules and plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../collections_guide/index.html">Using Ansible collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../os_guide/index.html">Using Ansible on Windows and BSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tips_tricks/index.html">Ansible tips and tricks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/index.html">Ansible Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/contributions_collections.html">Ansible Collections Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/contributions.html">ansible-core Contributors Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/advanced_index.html">Advanced Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev_guide/style_guide/index.html">Ansible documentation style guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev_guide/index.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../scenario_guides/cloud_guides.html">Legacy Public Cloud Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../network/getting_started/index.html">Network Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../network/user_guide/index.html">Network Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../network/dev_guide/index.html">Network Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Collection Index</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../amazon/index.html">Collections in the Amazon Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ansible/index.html">Collections in the Ansible Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arista/index.html">Collections in the Arista Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../awx/index.html">Collections in the Awx Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../azure/index.html">Collections in the Azure Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../check_point/index.html">Collections in the Check_point Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../chocolatey/index.html">Collections in the Chocolatey Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cisco/index.html">Collections in the Cisco Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cloud/index.html">Collections in the Cloud Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cloudscale_ch/index.html">Collections in the Cloudscale_ch Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/index.html">Collections in the Community Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../containers/index.html">Collections in the Containers Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cyberark/index.html">Collections in the Cyberark Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dellemc/index.html">Collections in the Dellemc Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../f5networks/index.html">Collections in the F5networks Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../fortinet/index.html">Collections in the Fortinet Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frr/index.html">Collections in the Frr Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../google/index.html">Collections in the Google Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../grafana/index.html">Collections in the Grafana Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hetzner/index.html">Collections in the Hetzner Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibm/index.html">Collections in the Ibm Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../infinidat/index.html">Collections in the Infinidat Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../infoblox/index.html">Collections in the Infoblox Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../inspur/index.html">Collections in the Inspur Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../junipernetworks/index.html">Collections in the Junipernetworks Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kaytus/index.html">Collections in the Kaytus Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kubernetes/index.html">Collections in the Kubernetes Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lowlydba/index.html">Collections in the Lowlydba Namespace</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Collections in the Microsoft Namespace</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Microsoft.Ad</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../index.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#communication">Communication</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../index.html#scenario-guides">Scenario Guides</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#plugin-index">Plugin Index</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../netapp/index.html">Collections in the Netapp Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../netapp_eseries/index.html">Collections in the Netapp_eseries Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../netbox/index.html">Collections in the Netbox Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ngine_io/index.html">Collections in the Ngine_io Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../openstack/index.html">Collections in the Openstack Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../openvswitch/index.html">Collections in the Openvswitch Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ovirt/index.html">Collections in the Ovirt Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../purestorage/index.html">Collections in the Purestorage Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensu/index.html">Collections in the Sensu Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../splunk/index.html">Collections in the Splunk Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../t_systems_mms/index.html">Collections in the T_systems_mms Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../telekom_mms/index.html">Collections in the Telekom_mms Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../theforeman/index.html">Collections in the Theforeman Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../vmware/index.html">Collections in the Vmware Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../vultr/index.html">Collections in the Vultr Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../vyos/index.html">Collections in the Vyos Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wti/index.html">Collections in the Wti Namespace</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../all_plugins.html">Indexes of all modules and plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/release_and_maintenance.html">Releases and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev_guide/testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/tower.html">Red Hat Ansible Automation Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/automationhub.html">Ansible Automation Hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../roadmap/ansible_roadmap_index.html">Ansible Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../roadmap/ansible_core_roadmap_index.html">ansible-core Roadmaps</a></li>
</ul>
<!-- extra nav elements for Ansible beyond RTD Sphinx Theme -->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Ansible</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Collection Index</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Collections in the Microsoft Namespace</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Microsoft.Ad</a></li>
      <li class="breadcrumb-item active">LDAP Inventory guide</li>
  <li class="wy-breadcrumbs-aside">
            <!-- Remove main index page as it is no longer editable -->
            
              <br>

            
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  <script>
    function startsWith(str, needle) {
      return str.slice(0, needle.length) == needle
    }
    function startsWithOneOf(str, needles) {
      return needles.some(function (needle) {
        return startsWith(str, needle);
      });
    }
    var banner = '';
      var extra_banner = '';
    /*use extra_banner for when we want something extra, like a survey or Community Day notice */
   /*  var extra_banner =
      '<div id="latest_extra_banner_id" class="admonition important">' +
        '<p style="padding-bottom: 1.2rem;">' +
        'Discuss Ansible in the new <a href="https://forum.ansible.com/t/welcome-to-the-ansible-community/5">Ansible Forum!</a>' +
        '</p>' +
      '</div>';
      */
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">' +
                     '<p>This is the testing site for Ansible Documentation. Unless you are reviewing pre-production changes, please visit the <a href="https://docs.ansible.com/ansible/latest/">official documentation website</a>.</p> <p></p>' +
                     '</div>');
    }
    
      // Create a banner
      current_url_path = window.location.pathname;

      var important = false;
      var msg = '<p>';
      if (startsWith(current_url_path, "/ansible-core/")) {
        msg += 'You are reading documentation for Ansible Core, which contains no plugins except for those in ansible.builtin. For documentation of the Ansible package, go to <a href="/ansible/latest">the latest documentation</a>.';
      } else if (startsWithOneOf(current_url_path, ["/ansible/latest/", "/ansible/10/"])) {
        /* temp extra banner to advertise something */
        banner += extra_banner;

        msg += 'This is the <b>latest</b> (stable) Ansible community documentation. For Red Hat Ansible Automation Platform subscriptions, see <a href="https://access.redhat.com/support/policy/updates/ansible-automation-platform">Life Cycle</a> for version details.';
      } else if (startsWith(current_url_path, "/ansible/2.9/")) {
        msg += 'You are reading the latest Red Hat released version of the Ansible documentation. Community users can use this version, or select <b>latest</b> from the version selector to the left for the most recent community version.';
      } else if (startsWith(current_url_path, "/ansible/devel/")) {
        /* temp extra banner to advertise something */
        banner += extra_banner;

        msg += 'You are reading the <b>devel</b> version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
      } else {
        msg += 'You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
        /* temp extra banner to advertise something - this is for testing*/
        banner += extra_banner;

      }
      msg += '</p>';

      banner += '<div id="banner_id" class="admonition ';
      banner += important ? 'important' : 'caution';
      banner += '">';
      banner += important ? '<br>' : '';
      banner += msg;
      banner += important ? '<br>' : '';
      banner += '</div>';
      document.write(banner);
    
  </script>


  
           <div itemprop="articleBody">
             
  <section id="ldap-inventory-guide">
<span id="ansible-collections-microsoft-ad-docsite-guide-ldap-inventory"></span><h1>LDAP Inventory guide<a class="headerlink" href="#ldap-inventory-guide" title="Link to this heading"></a></h1>
<p>This guide covers information about the LDAP inventory plugin included in this collection. This inventory plugin can be used to build an inventory from an LDAP server source, like Microsoft Active Directory.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#connection-info" id="id1">Connection info</a></p></li>
<li><p><a class="reference internal" href="#attributes" id="id2">Attributes</a></p></li>
<li><p><a class="reference internal" href="#inventory-hostname" id="id3">Inventory hostname</a></p></li>
<li><p><a class="reference internal" href="#value-types-and-templating" id="id4">Value types and templating</a></p></li>
<li><p><a class="reference internal" href="#laps" id="id5">LAPS</a></p></li>
</ul>
</nav>
<section id="connection-info">
<span id="ansible-collections-microsoft-ad-docsite-guide-ldap-inventory-connection-info"></span><h2><a class="toc-backref" href="#id1" role="doc-backlink">Connection info</a><a class="headerlink" href="#connection-info" title="Link to this heading"></a></h2>
<p>Details on how to configure an LDAP connection can be found under <a class="reference internal" href="guide_ldap_connection.html#ansible-collections-microsoft-ad-docsite-guide-ldap-connection"><span class="std std-ref">the LDAP connection guide</span></a>. Each of the connection options described by the plugin documentation are specified in the inventory yml configuration file like the below.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microsoft.ad.ldap</span>

<span class="c1"># LDAP connection options can be defined in the yaml config.</span>
<span class="nt">auth_protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple</span>
<span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UserName</span>
<span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MyPassword123</span>
<span class="nt">tls_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ldaps</span>
</pre></div>
</div>
</section>
<section id="attributes">
<span id="ansible-collections-microsoft-ad-docsite-guide-ldap-inventory-attributes"></span><h2><a class="toc-backref" href="#id2" role="doc-backlink">Attributes</a><a class="headerlink" href="#attributes" title="Link to this heading"></a></h2>
<p>The LDAP inventory plugin can be used to set custom facts for each host it retrieves based on the computer object’s LDAP attributes. Retrieving custom attributes is done through the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> option in the inventory plugin definition. The value is set to one of the three following types:</p>
<ul class="simple">
<li><p>Empty string or null</p></li>
<li><p>A template string</p></li>
<li><p>A dictionary</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While an individual attribute can only be set to one of these types, it is possible to use the different value types for different attributes.</p>
</div>
<p>It is also possible to use the <code class="docutils literal notranslate"><span class="pre">compose</span></code> inventory option to use the builtin compose templating provided by inventory plugins but the LDAP attributes must first be requested through the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> option and referenced in the <code class="docutils literal notranslate"><span class="pre">compose</span></code> template through the host fact the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> set it on.</p>
<section id="empty-string-or-null">
<h3>Empty string or null<a class="headerlink" href="#empty-string-or-null" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">comment</span><span class="p">:</span>
<span class="w">  </span><span class="nt">objectSid</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">  </span><span class="nt">ms-Mcs-AdmPwd</span><span class="p">:</span>
</pre></div>
</div>
<p>In this case each of the attribute values will be set as a host fact as they are coerced by the LDAP schema, see <a class="reference internal" href="#ansible-collections-microsoft-ad-docsite-guide-ldap-inventory-value-types"><span class="std std-ref">value types and templating</span></a>. The name of each fact will be based on the attribute name with <code class="docutils literal notranslate"><span class="pre">-</span></code> being replaced by <code class="docutils literal notranslate"><span class="pre">_</span></code>. In the above example the host facts <code class="docutils literal notranslate"><span class="pre">comment</span></code>, <code class="docutils literal notranslate"><span class="pre">objectSid</span></code>, and <code class="docutils literal notranslate"><span class="pre">ms_Mcs_AdmPwd</span></code> will be set to the coerced values.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">comment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test comment</span>
<span class="nt">ms_Mcs_AdmPwd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Password123!</span>
<span class="nt">objectSid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">S-1-5-21-1234-1108</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=MYHOST,CN=Computers,DC=domain,DC=com</span>
</pre></div>
</div>
</section>
<section id="template-string">
<h3>Template string<a class="headerlink" href="#template-string" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">comment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this</span>
<span class="w">  </span><span class="nt">objectSid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw | microsoft.ad.as_sid</span>
<span class="w">  </span><span class="nt">ms-Mcs-AdmPwd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw | first</span>
</pre></div>
</div>
<p>This format will set the host fact based on the template value specified. Each template is implicitly wrapped with <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">...</span> <span class="pre">}}</span></code> and processed through Jinja2 to produce a result. This means the template string can contain filters provided by Ansible and other collections to convert the raw LDAP value into something more useful. The <code class="docutils literal notranslate"><span class="pre">this</span></code> variable refers to the coerced LDAP attribute value and <code class="docutils literal notranslate"><span class="pre">raw</span></code> refers to a list of base64 encoded byte strings of the raw LDAP attribute value. See <a class="reference internal" href="#ansible-collections-microsoft-ad-docsite-guide-ldap-inventory-value-types"><span class="std std-ref">value types and templating</span></a> for more information around what can be done inside the templates. Each host fact will be named after the attribute name with <code class="docutils literal notranslate"><span class="pre">-</span></code> being replaced by <code class="docutils literal notranslate"><span class="pre">_</span></code>. In the above example the host facts <code class="docutils literal notranslate"><span class="pre">command</span></code>, <code class="docutils literal notranslate"><span class="pre">objectSid</span></code>, and <code class="docutils literal notranslate"><span class="pre">ms_Mcs_AdmPwd</span></code> will be set to the template results.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">comment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test comment</span>
<span class="nt">ms_Mcs_AdmPwd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UGFzc3dvcmQxMjMh</span>
<span class="nt">objectSid</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">S-1-5-21-1234-1108</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=MYHOST,CN=Computers,DC=domain,DC=com</span>
</pre></div>
</div>
</section>
<section id="dictionary">
<h3>Dictionary<a class="headerlink" href="#dictionary" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">comment</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Jinja2 native types will automatically convert this to a dict as</span>
<span class="w">    </span><span class="c1"># the value is a json string.</span>
<span class="w">    </span><span class="nt">my_comment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">other_var</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this | from_json</span>
<span class="w">  </span><span class="nt">objectSid</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw | microsoft.ad.as_sid | first</span>
<span class="w">  </span><span class="nt">ms-Mcs-AdmPwd</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ansible_password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this</span>
</pre></div>
</div>
<p>The final value that can be set on each attribute values is a dictionary where the keys are the host facts to set and the value is the template used to dervice the final value. It can be null or an empty string to refer to the LDAP coerced value of that attribute (<code class="docutils literal notranslate"><span class="pre">this</span></code>) or a template string to template a new value based on the requirements at hand. See the above two formats for more info on null/empty string vs a string template value. In the above example there are 4 host facts set:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">my_command</span></code> - the coerced value for the <code class="docutils literal notranslate"><span class="pre">comment</span></code> attribute</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">other_var</span></code> - a dictionary created from the coerced value of <code class="docutils literal notranslate"><span class="pre">comment</span></code> if it was a json string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sid</span></code> - the computer SID value as a string derived from <code class="docutils literal notranslate"><span class="pre">objectSid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ansible_password</span></code> - the LAPS password coerced value derived from <code class="docutils literal notranslate"><span class="pre">ms-Mcs-AdmPwd</span></code></p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">ansible_password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Password123!</span>
<span class="nt">my_comment</span><span class="p">:</span>
<span class="w">  </span><span class="nt">foo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span>
<span class="nt">other_var</span><span class="p">:</span>
<span class="w">  </span><span class="nt">foo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span>
<span class="nt">sid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">S-1-5-21-1234-1108</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=MYHOST,CN=Computers,DC=domain,DC=com</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The host fact names are used literally, there are no conversions from <code class="docutils literal notranslate"><span class="pre">-</span></code> to <code class="docutils literal notranslate"><span class="pre">_</span></code> when using this format.</p>
</div>
</section>
</section>
<section id="inventory-hostname">
<span id="ansible-collections-microsoft-ad-docsite-guide-ldap-inventory-inventory-hostname"></span><h2><a class="toc-backref" href="#id3" role="doc-backlink">Inventory hostname</a><a class="headerlink" href="#inventory-hostname" title="Link to this heading"></a></h2>
<p>By default the <code class="docutils literal notranslate"><span class="pre">inventory_hostname</span></code> for a found host will be based on the <code class="docutils literal notranslate"><span class="pre">name</span></code> LDAP attribute value. If the <code class="docutils literal notranslate"><span class="pre">dNSHostName</span></code> attribute is set for the computer account found, it will be set as the <code class="docutils literal notranslate"><span class="pre">ansible_host</span></code> fact. To define a custom <code class="docutils literal notranslate"><span class="pre">inventory_hostname</span></code> or <code class="docutils literal notranslate"><span class="pre">ansible_host</span></code> either set it in the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> or <code class="docutils literal notranslate"><span class="pre">compose</span></code> plugin option under that key. For example this will set the <code class="docutils literal notranslate"><span class="pre">inventory_hostname</span></code> to the value of <code class="docutils literal notranslate"><span class="pre">sAMAccountName</span></code> without the ending <code class="docutils literal notranslate"><span class="pre">$</span></code> rather than the computer account LDAP <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">sAMAccountName</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inventory_hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sAMAccountName[:-1]</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=OtherName,CN=Computers,DC=domain,DC=com</span>
<span class="nt">sAMAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST$</span>
</pre></div>
</div>
<p>It is also possible to set <code class="docutils literal notranslate"><span class="pre">inventory_hostname</span></code> under the <code class="docutils literal notranslate"><span class="pre">compose</span></code> key. The following will produce the same output as the above.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">sAMAccountName</span><span class="p">:</span>

<span class="nt">compose</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inventory_hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sAMAccountName[:-1]</span>
</pre></div>
</div>
<p>An example of setting a custom <code class="docutils literal notranslate"><span class="pre">ansible_host</span></code> fact that is used as the connection host but leaving the default <code class="docutils literal notranslate"><span class="pre">inventory_hostname</span></code> of the computer account name is:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">sAMAccountName</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sAMAccountName[:-1]</span>
</pre></div>
</div>
</section>
<section id="value-types-and-templating">
<span id="ansible-collections-microsoft-ad-docsite-guide-ldap-inventory-value-types"></span><h2><a class="toc-backref" href="#id4" role="doc-backlink">Value types and templating</a><a class="headerlink" href="#value-types-and-templating" title="Link to this heading"></a></h2>
<p>Each LDAP attribute value is stored as a list of bytes but the schema supplied in the LDAP database can describe how those raw list of bytes are represented as a proper type, like a string, integer, boolean, etc. Currently only these four types are used when coercing LDAP attribute values</p>
<ul class="simple">
<li><p>Booleans</p></li>
<li><p>Integers</p></li>
<li><p>Bytes</p></li>
<li><p>Strings</p></li>
</ul>
<p>Booleans, integers, and strings are coerced into those specific Python types but bytes are coerced into a base64 string encoding of those bytes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">objectGuid</span></code> and <code class="docutils literal notranslate"><span class="pre">objectSid</span></code> attributes are always coerced into strings representing the security identifier and guid respectively. These are the only attributes that have special coercion rules outside of the LDAP schema syntax.</p>
</div>
<p>LDAP attribute values may also be marked as a a single or multi valued attribute. A single value contains just the coerced value, or <code class="docutils literal notranslate"><span class="pre">None/null</span></code> if it has not been set while a multi valued attribute will be set as a list of coerced values. For example the <code class="docutils literal notranslate"><span class="pre">comment</span></code> is a single valued string while <code class="docutils literal notranslate"><span class="pre">servicePrincipalName</span></code> is a multi valued string. Using this inventory configuration that requests <code class="docutils literal notranslate"><span class="pre">comment</span></code>, and <code class="docutils literal notranslate"><span class="pre">servicePrincipalName</span></code> we get the following inventory host definition:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microsoft.ad.ldap</span>

<span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">comment</span><span class="p">:</span>
<span class="w">  </span><span class="nt">servicePrincipalName</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">comment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test comment</span>
<span class="nt">servicePrincipalName</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WSMAN/MYHOST</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WSMAN/MYHOST.domain.com</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TERMSRV/MYHOST</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TERMSRV/MYHOST.domain.com</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RestrictedKrbHost/MYHOST</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HOST/MYHOST</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RestrictedKrbHost/MYHOST.domain.com</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HOST/MYHOST.domain.com</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=MYHOST,CN=Computers,DC=domain,DC=com</span>
</pre></div>
</div>
<p>Some attributes like <code class="docutils literal notranslate"><span class="pre">pwdLastSet</span></code> are typically represented as a datetime value but internally are stored as integers. As there is no metadata in the LDAP schema to denote these integer values as datetime objects they will only be coerced into integer values by default.</p>
<p>The following filters can be used as an easy way to further convert the coerced values into something more readable:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../as_datetime_filter.html#ansible-collections-microsoft-ad-as-datetime-filter"><span class="std std-ref">microsoft.ad.as_datetime</span></a></p></li>
<li><p><a class="reference internal" href="../as_guid_filter.html#ansible-collections-microsoft-ad-as-guid-filter"><span class="std std-ref">microsoft.ad.as_guid</span></a></p></li>
<li><p><a class="reference internal" href="../as_sid_filter.html#ansible-collections-microsoft-ad-as-sid-filter"><span class="std std-ref">microsoft.ad.as_sid</span></a></p></li>
<li><p><a class="reference internal" href="../parse_dn_filter.html#ansible-collections-microsoft-ad-parse-dn-filter"><span class="std std-ref">microsoft.ad.parse_dn</span></a></p></li>
</ul>
<p>An example of these filters being used in the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> option can be seen below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microsoft.ad.ldap</span>

<span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pwdLastSet</span><span class="p">:</span>
<span class="w">    </span><span class="nt">password_last_set_int</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this</span>
<span class="w">    </span><span class="nt">password_last_set_datetime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this | microsoft.ad.as_datetime</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">password_last_set_datetime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2023-02-06T07:39:09.195321+0000</span>
<span class="nt">password_last_set_int</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">133201427491953218</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=MYHOST,CN=Computers,DC=domain,DC=com</span>
</pre></div>
</div>
<p>The templates can also reference other filters that exist outside the collection, like the Ansible builtin <code class="docutils literal notranslate"><span class="pre">from_json</span></code> and more. The value is simply what would be placed inside <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">...</span> <span class="pre">}}</span></code> during a normal template operation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Lookups cannot be used in the attribute value templates, only filters.</p>
</div>
<p>Each template used in the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> inventory option can reference the following variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">this</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">raw</span></code></p></li>
<li><p>Any previously defined attributes</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">this</span></code> variable refers to the coerced LDAP attribute value while <code class="docutils literal notranslate"><span class="pre">raw</span></code> refers to the list of base64 encoded strings representing the raw LDAP value that hasn’t been coerced. As each attribute host fact is processed, it is also available in the subsequent templates under that host fact name. Here is an example of a more complex set of attributes:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microsoft.ad.ldap</span>

<span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">objectSid</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this</span>
<span class="w">    </span><span class="nt">sid_raw</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw</span>
<span class="w">    </span><span class="nt">sid_raw_filtered</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw | microsoft.ad.as_sid | first</span>
<span class="w">  </span><span class="nt">objectGuid</span><span class="p">:</span>
<span class="w">  </span><span class="nt">sAMAccountName</span><span class="p">:</span>
<span class="w">    </span><span class="nt">computer_name</span><span class="p">:</span>
<span class="w">  </span><span class="nt">comment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">comment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this</span>
<span class="w">    </span><span class="c1"># Can refer to previously set attributes above</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">computer_name ~ &quot; - &quot; ~ sid ~ &quot; - &quot; ~ objectGuid ~ &quot; - &quot; ~ this</span>

<span class="c1"># Can also be used as a template and refer to the vars retrieved above</span>
<span class="nt">compose</span><span class="p">:</span>
<span class="w">  </span><span class="nt">comment2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">comment</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">comment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test comment</span>
<span class="nt">comment2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test comment</span>
<span class="nt">computer_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST$</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST$ - S-1-5-21-1234-1108 - 51cc490f-1de0-41ae-98ad-dc065d5b33e2 - test comment</span>
<span class="nt">objectGuid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">51cc490f-1de0-41ae-98ad-dc065d5b33e2</span>
<span class="nt">sid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">S-1-5-21-1234-1108</span>
<span class="nt">sid_raw</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AQMAAAAAAAUVAAAA0gQAAFQEAAA=</span>
<span class="nt">sid_raw_filtered</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">S-1-5-21-1234-1108</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=MYHOST,CN=Computers,DC=domain,DC=com</span>
</pre></div>
</div>
</section>
<section id="laps">
<span id="ansible-collections-microsoft-ad-docsite-guide-ldap-inventory-laps"></span><h2><a class="toc-backref" href="#id5" role="doc-backlink">LAPS</a><a class="headerlink" href="#laps" title="Link to this heading"></a></h2>
<p>Local Administrator Administrator Password Solution (LAPS) can be used to automatically change the password of the local administrator account on domain joined hosts. The LDAP connection plugin can retrieve the LAPS-managed value and assign it as the connection password for the target host.</p>
<p>There are three different attributes that can be used by LAPS to store the password information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ms-Mcs-AdmPwd</span></code> - The legacy LAPS attribute containing the password</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msLAPS-Password</span></code> - The Windows LAPS attribute containing the username and password</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msLAPS-EncryptedPassword</span></code> - The Windows LAPS attribute containing the encrypted username and password</p></li>
</ul>
<p>If using the legacy LAPS setup, the following will retrieve and assign the connection username and password to the LAPS-managed value:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microsoft.ad.ldap</span>

<span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ms-Mcs-AdmPwd</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&quot;Administrator&quot;&#39;</span>
<span class="w">    </span><span class="nt">ansible_password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">ansible_password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aR$lmrqK1l622H</span>
<span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Administrator</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=MYHOST,CN=Computers,DC=domain,DC=com</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Legacy LAPS does not store the username, the above example hardcodes the user name <code class="docutils literal notranslate"><span class="pre">Administrator</span></code>.</p>
</div>
<p>If using Windows LAPS without encryption, the following will assign the connection username and password to the LAPS-managed values:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microsoft.ad.ldap</span>

<span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">msLAPS-Password</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(this | from_json).n</span>
<span class="w">    </span><span class="nt">ansible_password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(this | from_json).p</span>
<span class="w">    </span><span class="nt">raw_example</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw</span>
<span class="w">    </span><span class="nt">this_example</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">ansible_password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWznso@ZJ+J6p9</span>
<span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Administrator</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=MYHOST,CN=Computers,DC=domain,DC=com</span>
<span class="nt">raw_example</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eyJuIjoiQWRtaW5pc3RyYXRvciIsInQiOiIxZDk4MmI0MzdiN2E1YzYiLCJwIjoiQVd6bnNvQFpKK0o2cDkifQ==</span>
<span class="nt">this_example</span><span class="p">:</span>
<span class="w">  </span><span class="nt">n</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Administrator</span>
<span class="w">  </span><span class="nt">p</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWznso@ZJ+J6p9</span>
<span class="w">  </span><span class="nt">t</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1d982b437b7a5c6</span>
</pre></div>
</div>
<p>Unlike Legacy LAPS, the attribute value is a json string that contains the keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n</span></code> - The account name the password was encrypted for</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p</span></code> - The password for the account</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">t</span></code> - The time the password was set encoded as a FILETIME in base16</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended to use the <code class="docutils literal notranslate"><span class="pre">from_json</span></code> filter (as shown in the example above) on the <code class="docutils literal notranslate"><span class="pre">this</span></code> value to ensure consistent behavior in the presence or absence of Jinja2 native type support.</p>
</div>
<p>Getting an encrypted Windows LAPS value requires the <code class="docutils literal notranslate"><span class="pre">dpapi-ng</span></code> Python library to be installed. See <a class="reference internal" href="guide_ldap_connection.html#ansible-collections-microsoft-ad-docsite-guide-ldap-connection-requirements"><span class="std std-ref">the LDAP connection requirements</span></a> for more information on this optional package and how to debug whether it’s installed or not.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using Windows LAPS encrypted password is currently an experimental feature.</p>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">dpapi-ng</span></code> package installed, an authorized LDAP user can decrypt and assign the LAPS-managed username and password to the target host connection as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microsoft.ad.ldap</span>

<span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">msLAPS-EncryptedPassword</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(this.value | from_json).n</span>
<span class="w">    </span><span class="nt">ansible_password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(this.value | from_json).p</span>
<span class="w">    </span><span class="nt">raw_example</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw</span>
<span class="w">    </span><span class="nt">this_example</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">ansible_password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6jr&amp;}yK++{0Q}&amp;</span>
<span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Administrator</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=MYHOST,CN=Computers,DC=domain,DC=com</span>
<span class="nt">raw_example</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">toLZAWR7rgfk...</span>
<span class="nt">this_example</span><span class="p">:</span>
<span class="w">  </span><span class="nt">encrypted_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MIIETgYJKoZI...</span>
<span class="w">  </span><span class="nt">flags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">info</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">  </span><span class="nt">update_timestamp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">133281382308674404</span>
<span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{&quot;n&quot;:&quot;Administrator&quot;,&quot;t&quot;:&quot;1d982b607ae7b64&quot;,&quot;p&quot;:&quot;6jr&amp;}yK++{0Q}&amp;&quot;}&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">raw</span></code> value contains the raw base64 encoded value as stored in AD. The <code class="docutils literal notranslate"><span class="pre">this</span></code> value contains a dictionary with the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">encrypted_value</span></code>: The encrypted password blob as a base64 string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flags</span></code>: The flags set as a bitwise int value, currently these are undocumented by Microsoft</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_timestamp</span></code>: The FILETIME value of when the</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: The decrypted value containing the username and password as a JSON string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">debug</span></code>: Debug information that indicates why it failed to decrypt the value</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">value</span></code> key will only be present if the decryption process was successful. If it failed, the <code class="docutils literal notranslate"><span class="pre">debug</span></code> key will be present and contain the reason why it failed to be decrypted.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">dpapi-ng</span></code> library is not installed this is what the output would look like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=MYHOST,CN=Computers,DC=domain,DC=com</span>
<span class="nt">raw_example</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">toLZAWR7rgfk...</span>
<span class="nt">this_example</span><span class="p">:</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cannot decrypt value as the Python library dpapi-ng is not installed</span>
<span class="w">  </span><span class="nt">encrypted_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MIIETgYJKoZI...</span>
<span class="w">  </span><span class="nt">flags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">update_timestamp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">133281382308674404</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">value</span></code> key is no longer present and <code class="docutils literal notranslate"><span class="pre">debug</span></code> contains the message that <code class="docutils literal notranslate"><span class="pre">dpapi-ng</span></code> is not installed.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">dpapi-ng</span></code> library was installed but the connection user is not authorized to decrypt the value this is what the output would look like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ansible-inventory -i microsoft.ad.ldap.yml --host MYHOST --vars --yaml</span>

<span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYHOST.domain.com</span>
<span class="nt">microsoft_ad_distinguished_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=MYHOST,CN=Computers,DC=domain,DC=com</span>
<span class="nt">raw_example</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">toLZAWR7rgfk...</span>
<span class="nt">this_example</span><span class="p">:</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Failed to decrypt value due to error - ValueError GetKey failed 0x80070005</span>
<span class="w">  </span><span class="nt">encrypted_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MIIETgYJKoZI...</span>
<span class="w">  </span><span class="nt">flags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">update_timestamp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">133281382308674404</span>
</pre></div>
</div>
<p>A simple way to test that the connection user is able to decrypt the password is to run <code class="docutils literal notranslate"><span class="pre">Get-LapsADPassword</span> <span class="pre">-Identity</span> <span class="pre">MYHOST</span></code> on a Windows host as that user.</p>
</section>
</section>


           </div>
          </div>
          

<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="guide_ldap_connection.html" class="btn btn-neutral float-left" title="LDAP Connection guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="guide_list_values.html" class="btn btn-neutral float-right" title="Setting list option values guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ansible project contributors.
      <span class="lastupdated">Last updated on Jun 13, 2024.
      </span></p>
  </div>

  
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script><!-- extra footer elements for Ansible beyond RTD Sphinx Theme -->
<!-- begin analytics -->
<script>
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = 'https://js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script>
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script>

</body>
</html>