<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roles &mdash; Ansible Community Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5707b69d" />
      <link rel="stylesheet" type="text/css" href="../_static/css/ansible.css?v=c5b67dd2" />
      <link rel="stylesheet" type="text/css" href="../_static/antsibull-minimal.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/rtd-ethical-ads.css?v=289b023e" />

  
    <link rel="shortcut icon" href="../_static/images/Ansible-Mark-RGB_Black.png"/>
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_reuse_roles.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=c7b8e248"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Module defaults" href="playbooks_module_defaults.html" />
    <link rel="prev" title="Re-using Ansible artifacts" href="playbooks_reuse.html" /><!-- extra head elements for Ansible beyond RTD Sphinx Theme -->
<script src="https://www.redhat.com/dtm.js"></script>


<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="devel">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->



<script>
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','https://s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

</head>

<body class="wy-body-for-nav"><!-- extra body elements for Ansible beyond RTD Sphinx Theme -->
<!-- Google Tag Manager -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

<div class="DocSite-globalNav ansibleNav">
  <ul>
    <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
    <li><a href="https://forum.ansible.com/" target="_blank">Ansible community forum</a></li>
    <li><a href="https://docs.ansible.com/" target="_blank">Documentation</a></li>
  </ul>
</div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/Ansible-Mark-RGB_White.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">Ansible Community Documentation</div>
</a>
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Ansible
          </a>
              <div class="version">
                devel
              </div><!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <form class="version-dropdown" method="get">
      <script>
        function switchVersionTo(slug) {
          var current_url_path = window.location.pathname;
          var url_version = current_url_path.search("/devel/") > -1
            ? "/devel/"
            : "/latest/";
          var new_version_url = current_url_path.replace(url_version, "/" + slug + "/");
          window.location.replace(new_version_url);
        }
      </script>
      <label class="sr-only" for="version-list">Select version:</label>
      <select
          class="version-list"
          id="version-list"
          onchange="switchVersionTo(this.value);"
      >
        
        <option
            value="latest"
            
        >
            latest
        </option>
        
        <option
            value="9"
            
        >
            9
        </option>
        
        <option
            value="2.9"
            
        >
            2.9
        </option>
        
        <option
            value="devel"
            selected="selected"
        >
            devel
        </option>
        
      </select>
    </form>
  
</div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" method="get">
    <label class="sr-only" for="q">Search docs:</label>
    <input type="text" class="st-default-search-input" id="q" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Ansible getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting started with Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started_ee/index.html">Getting started with Execution Environments</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using Ansible</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../inventory_guide/index.html">Building Ansible inventories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_guide/index.html">Using Ansible command line tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Using Ansible playbooks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="playbooks_intro.html">Ansible playbooks</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="playbooks.html">Working with playbooks</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="playbooks_templating.html">Templating (Jinja2)</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_filters.html">Using filters to manipulate data</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_tests.html">Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_lookups.html">Lookups</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_python_version.html">Python3 in templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_templating_now.html">The now function: get the current time</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_templating_undef.html">The undef function: add hint for undefined variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_loops.html">Loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_delegation.html">Controlling where tasks run: delegation and local actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_conditionals.html">Conditionals</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_blocks.html">Blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_handlers.html">Handlers: running operations on change</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_error_handling.html">Error handling in playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_environment.html">Setting the remote environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_environment.html#working-with-language-specific-version-managers">Working with language-specific version managers</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_reuse.html">Re-using Ansible artifacts</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Roles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#role-directory-structure">Role directory structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#storing-and-finding-roles">Storing and finding roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-roles">Using roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#role-argument-validation">Role argument validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-a-role-multiple-times-in-one-play">Running a role multiple times in one play</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-role-dependencies">Using role dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#embedding-modules-and-plugins-in-roles">Embedding modules and plugins in roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sharing-roles-ansible-galaxy">Sharing roles: Ansible Galaxy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_module_defaults.html">Module defaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_prompts.html">Interactive input: prompts</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_variables.html">Using Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_vars_facts.html">Discovering variables: facts and magic variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="guide_rolling_upgrade.html">Playbook Example: Continuous Delivery and Rolling Upgrades</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_execution.html">Executing playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_advanced_syntax.html">Advanced playbook syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="complex_data_manipulation.html">Manipulating data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../vault_guide/index.html">Protecting sensitive data with Ansible vault</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_plugin_guide/index.html">Using Ansible modules and plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collections_guide/index.html">Using Ansible collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../os_guide/index.html">Using Ansible on Windows and BSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips_tricks/index.html">Ansible tips and tricks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Ansible Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/contributions_collections.html">Ansible Collections Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/contributions.html">ansible-core Contributors Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/advanced_index.html">Advanced Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/style_guide/index.html">Ansible documentation style guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/index.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/cloud_guides.html">Legacy Public Cloud Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/getting_started/index.html">Network Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/user_guide/index.html">Network Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/dev_guide/index.html">Network Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../collections/index.html">Collection Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collections/all_plugins.html">Indexes of all modules and plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/release_and_maintenance.html">Releases and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/tower.html">Red Hat Ansible Automation Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/automationhub.html">Ansible Automation Hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/ansible_roadmap_index.html">Ansible Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/ansible_core_roadmap_index.html">ansible-core Roadmaps</a></li>
</ul>
<!-- extra nav elements for Ansible beyond RTD Sphinx Theme -->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Using Ansible playbooks</a></li>
          <li class="breadcrumb-item"><a href="playbooks.html">Working with playbooks</a></li>
      <li class="breadcrumb-item active">Roles</li>
  <li class="wy-breadcrumbs-aside">
            <!-- Remove main index page as it is no longer editable -->
            
              <a href="https://github.com/ansible/ansible-documentation/edit/devel/docs/docsite/rst/playbook_guide/playbooks_reuse_roles.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="fa fa-github"> Edit on GitHub</a>
            
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  <script>
    function startsWith(str, needle) {
      return str.slice(0, needle.length) == needle
    }
    function startsWithOneOf(str, needles) {
      return needles.some(function (needle) {
        return startsWith(str, needle);
      });
    }
    var banner = '';
      var extra_banner = '';
    /*use extra_banner for when we want something extra, like a survey or Community Day notice */
   /*  var extra_banner =
      '<div id="latest_extra_banner_id" class="admonition important">' +
        '<p style="padding-bottom: 1.2rem;">' +
        'Discuss Ansible in the new <a href="https://forum.ansible.com/t/welcome-to-the-ansible-community/5">Ansible Forum!</a>' +
        '</p>' +
      '</div>';
      */
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">' +
                     '<p>This is the testing site for Ansible Documentation. Unless you are reviewing pre-production changes, please visit the <a href="https://docs.ansible.com/ansible/latest/">official documentation website</a>.</p> <p></p>' +
                     '</div>');
    }
    
      // Create a banner
      current_url_path = window.location.pathname;

      var important = false;
      var msg = '<p>';
      if (startsWith(current_url_path, "/ansible-core/")) {
        msg += 'You are reading documentation for Ansible Core, which contains no plugins except for those in ansible.builtin. For documentation of the Ansible package, go to <a href="/ansible/latest">the latest documentation</a>.';
      } else if (startsWithOneOf(current_url_path, ["/ansible/latest/", "/ansible/10/"])) {
        /* temp extra banner to advertise something */
        banner += extra_banner;

        msg += 'This is the <b>latest</b> (stable) Ansible community documentation. For Red Hat Ansible Automation Platform subscriptions, see <a href="https://access.redhat.com/support/policy/updates/ansible-automation-platform">Life Cycle</a> for version details.';
      } else if (startsWith(current_url_path, "/ansible/2.9/")) {
        msg += 'You are reading the latest Red Hat released version of the Ansible documentation. Community users can use this version, or select <b>latest</b> from the version selector to the left for the most recent community version.';
      } else if (startsWith(current_url_path, "/ansible/devel/")) {
        /* temp extra banner to advertise something */
        banner += extra_banner;

        msg += 'You are reading the <b>devel</b> version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
      } else {
        msg += 'You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
        /* temp extra banner to advertise something - this is for testing*/
        banner += extra_banner;

      }
      msg += '</p>';

      banner += '<div id="banner_id" class="admonition ';
      banner += important ? 'important' : 'caution';
      banner += '">';
      banner += important ? '<br>' : '';
      banner += msg;
      banner += important ? '<br>' : '';
      banner += '</div>';
      document.write(banner);
    
  </script>


  
           <div itemprop="articleBody">
             
  <section id="roles">
<span id="playbooks-reuse-roles"></span><h1>Roles<a class="headerlink" href="#roles" title="Link to this heading"></a></h1>
<p>Roles let you automatically load related vars, files, tasks, handlers, and other Ansible artifacts based on a known file structure. After you group your content into roles, you can easily reuse them and share them with other users.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#role-directory-structure" id="id3">Role directory structure</a></p></li>
<li><p><a class="reference internal" href="#storing-and-finding-roles" id="id4">Storing and finding roles</a></p></li>
<li><p><a class="reference internal" href="#using-roles" id="id5">Using roles</a></p>
<ul>
<li><p><a class="reference internal" href="#using-roles-at-the-play-level" id="id6">Using roles at the play level</a></p></li>
<li><p><a class="reference internal" href="#including-roles-dynamic-reuse" id="id7">Including roles: dynamic reuse</a></p></li>
<li><p><a class="reference internal" href="#importing-roles-static-reuse" id="id8">Importing roles: static reuse</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#role-argument-validation" id="id9">Role argument validation</a></p>
<ul>
<li><p><a class="reference internal" href="#specification-format" id="id10">Specification format</a></p></li>
<li><p><a class="reference internal" href="#sample-specification" id="id11">Sample specification</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-a-role-multiple-times-in-one-play" id="id12">Running a role multiple times in one play</a></p>
<ul>
<li><p><a class="reference internal" href="#passing-different-parameters" id="id13">Passing different parameters</a></p></li>
<li><p><a class="reference internal" href="#using-allow-duplicates-true" id="id14">Using <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-role-dependencies" id="id15">Using role dependencies</a></p>
<ul>
<li><p><a class="reference internal" href="#running-role-dependencies-multiple-times-in-one-play" id="id16">Running role dependencies multiple times in one play</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#embedding-modules-and-plugins-in-roles" id="id17">Embedding modules and plugins in roles</a></p></li>
<li><p><a class="reference internal" href="#sharing-roles-ansible-galaxy" id="id18">Sharing roles: Ansible Galaxy</a></p></li>
</ul>
</nav>
<section id="role-directory-structure">
<span id="id1"></span><h2><a class="toc-backref" href="#id3" role="doc-backlink">Role directory structure</a><a class="headerlink" href="#role-directory-structure" title="Link to this heading"></a></h2>
<p>An Ansible role has a defined directory structure with seven main standard directories. You must include at least one of these directories in each role. You can omit any directories the role does not use. For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># playbooks
site.yml
webservers.yml
fooservers.yml
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">roles/</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">common/</span><span class="w">               </span><span class="c1"># this hierarchy represents a &quot;role&quot;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">tasks/</span><span class="w">            </span><span class="c1">#</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">main.yml</span><span class="w">      </span><span class="c1">#  &lt;-- tasks file can include smaller files if warranted</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">handlers/</span><span class="w">         </span><span class="c1">#</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">main.yml</span><span class="w">      </span><span class="c1">#  &lt;-- handlers file</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">templates/</span><span class="w">        </span><span class="c1">#  &lt;-- files for use with the template resource</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">ntp.conf.j2</span><span class="w">   </span><span class="c1">#  &lt;------- templates end in .j2</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">files/</span><span class="w">            </span><span class="c1">#</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">bar.txt</span><span class="w">       </span><span class="c1">#  &lt;-- files for use with the copy resource</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">foo.sh</span><span class="w">        </span><span class="c1">#  &lt;-- script files for use with the script resource</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">vars/</span><span class="w">             </span><span class="c1">#</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">main.yml</span><span class="w">      </span><span class="c1">#  &lt;-- variables associated with this role</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">defaults/</span><span class="w">         </span><span class="c1">#</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">main.yml</span><span class="w">      </span><span class="c1">#  &lt;-- default lower priority variables for this role</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">meta/</span><span class="w">             </span><span class="c1">#</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">main.yml</span><span class="w">      </span><span class="c1">#  &lt;-- role dependencies</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">library/</span><span class="w">          </span><span class="c1"># roles can also include custom modules</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">module_utils/</span><span class="w">     </span><span class="c1"># roles can also include custom module_utils</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">lookup_plugins/</span><span class="w">   </span><span class="c1"># or other types of plugins, like lookup in this case</span>

<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">webtier/</span><span class="w">              </span><span class="c1"># same kind of structure as &quot;common&quot; was above, done for the webtier role</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">monitoring/</span><span class="w">           </span><span class="c1"># &quot;&quot;</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">fooapp/</span><span class="w">               </span><span class="c1"># &quot;&quot;</span>
</pre></div>
</div>
<p>By default, Ansible will look in most role directories for a <code class="docutils literal notranslate"><span class="pre">main.yml</span></code> file for relevant content (also <code class="docutils literal notranslate"><span class="pre">main.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">main</span></code>):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tasks/main.yml</span></code> - A list of tasks that the role provides to the play for execution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">handlers/main.yml</span></code> - handlers that are imported into the parent play for use by the role or other roles and tasks in the play.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">defaults/main.yml</span></code> - very low precedence values for variables provided by the role (see <a class="reference internal" href="playbooks_variables.html#playbooks-variables"><span class="std std-ref">Using Variables</span></a> for more information). A role’s own defaults will take priority over other role’s defaults, but any/all other variable sources will override this.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vars/main.yml</span></code> - high precedence variables provided by the role to the play (see <a class="reference internal" href="playbooks_variables.html#playbooks-variables"><span class="std std-ref">Using Variables</span></a> for more information).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">files/stuff.txt</span></code> - one or more files that are available for the role and it’s children.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">templates/something.j2</span></code> - templates to use in the role or child roles.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> - metadata for the role, including role dependencies and optional Galaxy metadata such as platforms supported. This is required for uploading into galaxy as a standalone role, but not for using the role in your play.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>None of the files above are required for a role. For example, you can just provide <code class="docutils literal notranslate"><span class="pre">files/something.txt</span></code> or <code class="docutils literal notranslate"><span class="pre">vars/for_import.yml</span></code> and it will still be a valid role.</p></li>
<li><p>On stand alone roles you can also include custom modules and/or plugins, for example <code class="docutils literal notranslate"><span class="pre">library/my_module.py</span></code>, which may be used within this role (see <a class="reference internal" href="#embedding-modules-and-plugins-in-roles"><span class="std std-ref">Embedding modules and plugins in roles</span></a> for more information).</p></li>
<li><p>A ‘stand alone’ role refers to role that is not part of a collection but as individually installable content.</p></li>
<li><p>Variables from <code class="docutils literal notranslate"><span class="pre">vars/</span></code> and <code class="docutils literal notranslate"><span class="pre">defaults/</span></code> are imported into play scope unless you disable it via the <code class="docutils literal notranslate"><span class="pre">public</span></code> option in <code class="docutils literal notranslate"><span class="pre">import_role</span></code>/<code class="docutils literal notranslate"><span class="pre">include_role</span></code>.</p></li>
</ul>
</div>
<p>You can add other YAML files in some directories, but they won’t be used by default. They can be included/imported directly or specified when using <code class="docutils literal notranslate"><span class="pre">include_role/import_role</span></code>.
For example, you can place platform-specific tasks in separate files and refer to them in the <code class="docutils literal notranslate"><span class="pre">tasks/main.yml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># roles/example/tasks/main.yml</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install the correct web server for RHEL</span>
<span class="w">  </span><span class="nt">import_tasks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redhat.yml</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts[&#39;os_family&#39;]|lower == &#39;redhat&#39;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install the correct web server for Debian</span>
<span class="w">  </span><span class="nt">import_tasks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">debian.yml</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts[&#39;os_family&#39;]|lower == &#39;debian&#39;</span>

<span class="c1"># roles/example/tasks/redhat.yml</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install web server</span>
<span class="w">  </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;httpd&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="c1"># roles/example/tasks/debian.yml</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install web server</span>
<span class="w">  </span><span class="nt">ansible.builtin.apt</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apache2&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</pre></div>
</div>
<p>Or call those tasks directly when loading the role, which bypasses the <code class="docutils literal notranslate"><span class="pre">main.yml</span></code> files:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">include apt tasks</span>
<span class="w">  </span><span class="nt">include_role</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">package_manager_bootstrap</span>
<span class="w">      </span><span class="nt">tasks_from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apt.yml</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts[&#39;os_family&#39;] == &#39;Debian&#39;</span>
</pre></div>
</div>
<p>Directories <code class="docutils literal notranslate"><span class="pre">defaults</span></code> and <code class="docutils literal notranslate"><span class="pre">vars</span></code> may also include <em>nested directories</em>. If your variables file is a directory, Ansible reads all variables files and directories inside in alphabetical order. If a nested directory contains variables files as well as directories, Ansible reads the directories first. Below is an example of a <code class="docutils literal notranslate"><span class="pre">vars/main</span></code> directory:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>roles/
    common/          # this hierarchy represents a &quot;role&quot;
        vars/
            main/    #  &lt;-- variables associated with this role
                first_nested_directory/
                    first_variables_file.yml
                second_nested_directory/
                    second_variables_file.yml
                third_variables_file.yml
</pre></div>
</div>
</section>
<section id="storing-and-finding-roles">
<span id="role-search-path"></span><h2><a class="toc-backref" href="#id4" role="doc-backlink">Storing and finding roles</a><a class="headerlink" href="#storing-and-finding-roles" title="Link to this heading"></a></h2>
<p>By default, Ansible looks for roles in the following locations:</p>
<ul class="simple">
<li><p>in collections, if you are using them</p></li>
<li><p>in a directory called <code class="docutils literal notranslate"><span class="pre">roles/</span></code>, relative to the playbook file</p></li>
<li><p>in the configured <a class="reference internal" href="../reference_appendices/config.html#default-roles-path"><span class="std std-ref">roles_path</span></a>. The default search path is <code class="docutils literal notranslate"><span class="pre">~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles</span></code>.</p></li>
<li><p>in the directory where the playbook file is located</p></li>
</ul>
<p>If you store your roles in a different location, set the <a class="reference internal" href="../reference_appendices/config.html#default-roles-path"><span class="std std-ref">roles_path</span></a> configuration option so Ansible can find your roles. Checking shared roles into a single location makes them easier to use in multiple playbooks. See <a class="reference internal" href="../installation_guide/intro_configuration.html#intro-configuration"><span class="std std-ref">Configuring Ansible</span></a> for details about managing settings in <code class="docutils literal notranslate"><span class="pre">ansible.cfg</span></code>.</p>
<p>Alternatively, you can call a role with a fully qualified path:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/path/to/my/roles/common&#39;</span>
</pre></div>
</div>
</section>
<section id="using-roles">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Using roles</a><a class="headerlink" href="#using-roles" title="Link to this heading"></a></h2>
<p>You can use roles in the following ways:</p>
<ul class="simple">
<li><p>at the play level with the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option: This is the classic way of using roles in a play.</p></li>
<li><p>at the tasks level with <code class="docutils literal notranslate"><span class="pre">include_role</span></code>: You can reuse roles dynamically anywhere in the <code class="docutils literal notranslate"><span class="pre">tasks</span></code> section of a play using <code class="docutils literal notranslate"><span class="pre">include_role</span></code>.</p></li>
<li><p>at the tasks level with <code class="docutils literal notranslate"><span class="pre">import_role</span></code>: You can reuse roles statically anywhere in the <code class="docutils literal notranslate"><span class="pre">tasks</span></code> section of a play using <code class="docutils literal notranslate"><span class="pre">import_role</span></code>.</p></li>
<li><p>as a dependency of another role (see the <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> keyword in <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> in this same page).</p></li>
</ul>
<section id="using-roles-at-the-play-level">
<span id="roles-keyword"></span><h3><a class="toc-backref" href="#id6" role="doc-backlink">Using roles at the play level</a><a class="headerlink" href="#using-roles-at-the-play-level" title="Link to this heading"></a></h3>
<p>The classic (original) way to use roles is with the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option for a given play:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
</pre></div>
</div>
<p>When you use the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option at the play level, each role ‘x’ looks for a <code class="docutils literal notranslate"><span class="pre">main.yml</span></code> (also <code class="docutils literal notranslate"><span class="pre">main.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">main</span></code>) in the following directories:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">roles/x/tasks/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">roles/x/handlers/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">roles/x/vars/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">roles/x/defaults/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">roles/x/meta/</span></code></p></li>
<li><p>Any copy, script, template or include tasks (in the role) can reference files in roles/x/{files,templates,tasks}/ (dir depends on task) without having to path them relatively or absolutely.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">vars</span></code> and <code class="docutils literal notranslate"><span class="pre">defaults</span></code> can also match to a directory of the same name and Ansible will process all the files contained in that directory. See <a class="reference internal" href="#role-directory-structure"><span class="std std-ref">Role directory structure</span></a> for more details.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you use <code class="docutils literal notranslate"><span class="pre">include_role/import_role</span></code>, you can specify a custom file name instead of <code class="docutils literal notranslate"><span class="pre">main</span></code>. The <code class="docutils literal notranslate"><span class="pre">meta</span></code> directory is an exception because it does not allow for customization.</p>
</div>
<p>When you use the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option at the play level, Ansible treats the roles as static imports and processes them during playbook parsing. Ansible executes each play in this order:</p>
<ul class="simple">
<li><p>Any <code class="docutils literal notranslate"><span class="pre">pre_tasks</span></code> defined in the play.</p></li>
<li><p>Any handlers triggered by pre_tasks.</p></li>
<li><p>Each role listed in <code class="docutils literal notranslate"><span class="pre">roles:</span></code>, in the order listed. Any role dependencies defined in the role’s <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> run first, subject to tag filtering and conditionals. See <a class="reference internal" href="#role-dependencies"><span class="std std-ref">Using role dependencies</span></a> for more details.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">tasks</span></code> defined in the play.</p></li>
<li><p>Any handlers triggered by the roles or tasks.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">post_tasks</span></code> defined in the play.</p></li>
<li><p>Any handlers triggered by post_tasks.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If using tags with tasks in a role, be sure to also tag your pre_tasks, post_tasks, and role dependencies and pass those along as well, especially if the pre/post tasks and role dependencies are used for monitoring outage window control or load balancing. See <a class="reference internal" href="playbooks_tags.html#tags"><span class="std std-ref">Tags</span></a> for details on adding and using tags.</p>
</div>
<p>You can pass other keywords to the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo_app_instance</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/opt/a&#39;</span>
<span class="w">        </span><span class="nt">app_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">typeA</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo_app_instance</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/opt/b&#39;</span>
<span class="w">        </span><span class="nt">app_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5001</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">typeB</span>
</pre></div>
</div>
<p>When you add a tag to the <code class="docutils literal notranslate"><span class="pre">role</span></code> option, Ansible applies the tag to ALL tasks within the role.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to <code class="docutils literal notranslate"><span class="pre">ansible-core</span></code> 2.15, <code class="docutils literal notranslate"><span class="pre">vars:</span></code> within the <code class="docutils literal notranslate"><span class="pre">roles:</span></code> section of a playbook are added to the play variables, making them available to all tasks within the play before and after the role. This behavior can be changed by <a class="reference internal" href="../reference_appendices/config.html#default-private-role-vars"><span class="std std-ref">DEFAULT_PRIVATE_ROLE_VARS</span></a>. On more recent versions, <code class="docutils literal notranslate"><span class="pre">vars:</span></code> do not leak into the play’s variable scope.</p>
</div>
</section>
<section id="including-roles-dynamic-reuse">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Including roles: dynamic reuse</a><a class="headerlink" href="#including-roles-dynamic-reuse" title="Link to this heading"></a></h3>
<p>You can reuse roles dynamically anywhere in the <code class="docutils literal notranslate"><span class="pre">tasks</span></code> section of a play using <code class="docutils literal notranslate"><span class="pre">include_role</span></code>. While roles added in a <code class="docutils literal notranslate"><span class="pre">roles</span></code> section run before any other tasks in a play, included roles run in the order they are defined. If there are other tasks before an <code class="docutils literal notranslate"><span class="pre">include_role</span></code> task, the other tasks will run first.</p>
<p>To include a role:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print a message</span>
<span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;this</span><span class="nv"> </span><span class="s">task</span><span class="nv"> </span><span class="s">runs</span><span class="nv"> </span><span class="s">before</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">role&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Include the example role</span>
<span class="w">      </span><span class="nt">include_role</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print a message</span>
<span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;this</span><span class="nv"> </span><span class="s">task</span><span class="nv"> </span><span class="s">runs</span><span class="nv"> </span><span class="s">after</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">role&quot;</span>
</pre></div>
</div>
<p>You can pass other keywords, including variables and tags, when including roles:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Include the foo_app_instance role</span>
<span class="w">      </span><span class="nt">include_role</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo_app_instance</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/opt/a&#39;</span>
<span class="w">        </span><span class="nt">app_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">typeA</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>When you add a <a class="reference internal" href="playbooks_tags.html#tags"><span class="std std-ref">tag</span></a> to an <code class="docutils literal notranslate"><span class="pre">include_role</span></code> task, Ansible applies the tag <strong>only</strong> to the include itself. This means you can pass <code class="docutils literal notranslate"><span class="pre">--tags</span></code> to run only selected tasks from the role, if those tasks themselves have the same tag as the include statement. See <a class="reference internal" href="playbooks_tags.html#selective-reuse"><span class="std std-ref">Selectively running tagged tasks in reusable files</span></a> for details.</p>
<p>You can conditionally include a role:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Include the some_role role</span>
<span class="w">      </span><span class="nt">include_role</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">some_role</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ansible_facts[&#39;os_family&#39;]</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;RedHat&#39;&quot;</span>
</pre></div>
</div>
</section>
<section id="importing-roles-static-reuse">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Importing roles: static reuse</a><a class="headerlink" href="#importing-roles-static-reuse" title="Link to this heading"></a></h3>
<p>You can reuse roles statically anywhere in the <code class="docutils literal notranslate"><span class="pre">tasks</span></code> section of a play using <code class="docutils literal notranslate"><span class="pre">import_role</span></code>. The behavior is the same as using the <code class="docutils literal notranslate"><span class="pre">roles</span></code> keyword. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print a message</span>
<span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;before</span><span class="nv"> </span><span class="s">we</span><span class="nv"> </span><span class="s">run</span><span class="nv"> </span><span class="s">our</span><span class="nv"> </span><span class="s">role&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Import the example role</span>
<span class="w">      </span><span class="nt">import_role</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print a message</span>
<span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;after</span><span class="nv"> </span><span class="s">we</span><span class="nv"> </span><span class="s">ran</span><span class="nv"> </span><span class="s">our</span><span class="nv"> </span><span class="s">role&quot;</span>
</pre></div>
</div>
<p>You can pass other keywords, including variables and tags when importing roles:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Import the foo_app_instance role</span>
<span class="w">      </span><span class="nt">import_role</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo_app_instance</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/opt/a&#39;</span>
<span class="w">        </span><span class="nt">app_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>When you add a tag to an <code class="docutils literal notranslate"><span class="pre">import_role</span></code> statement, Ansible applies the tag to <strong>all</strong> tasks within the role. See <a class="reference internal" href="playbooks_tags.html#tag-inheritance"><span class="std std-ref">Tag inheritance: adding tags to multiple tasks</span></a> for details.</p>
</section>
</section>
<section id="role-argument-validation">
<span id="role-argument-spec"></span><h2><a class="toc-backref" href="#id9" role="doc-backlink">Role argument validation</a><a class="headerlink" href="#role-argument-validation" title="Link to this heading"></a></h2>
<p>Beginning with version 2.11, you may choose to enable role argument validation based on an argument
specification. This specification is defined in the <code class="docutils literal notranslate"><span class="pre">meta/argument_specs.yml</span></code> file (or with the <code class="docutils literal notranslate"><span class="pre">.yaml</span></code>
file extension). When this argument specification is defined, a new task is inserted at the beginning of role execution
that will validate the parameters supplied for the role against the specification. If the parameters fail
validation, the role will fail execution.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ansible also supports role specifications defined in the role <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> file, as well. However,
any role that defines the specs within this file will not work on versions below 2.11. For this reason,
we recommend using the <code class="docutils literal notranslate"><span class="pre">meta/argument_specs.yml</span></code> file to maintain backward compatibility.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When role argument validation is used on a role that has defined <a class="reference internal" href="#role-dependencies"><span class="std std-ref">dependencies</span></a>,
then validation on those dependencies will run before the dependent role, even if argument validation fails
for the dependent role.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ansible tags the inserted role argument validation task with <a class="reference internal" href="playbooks_tags.html#special-tags"><span class="std std-ref">always</span></a>.
If the role is <a class="reference internal" href="playbooks_reuse.html#dynamic-vs-static"><span class="std std-ref">statically imported</span></a> this task runs unless you use the <code class="docutils literal notranslate"><span class="pre">--skip-tags</span></code> flag.</p>
</div>
<section id="specification-format">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Specification format</a><a class="headerlink" href="#specification-format" title="Link to this heading"></a></h3>
<p>The role argument specification must be defined in a top-level <code class="docutils literal notranslate"><span class="pre">argument_specs</span></code> block within the
role <code class="docutils literal notranslate"><span class="pre">meta/argument_specs.yml</span></code> file. All fields are lowercase.</p>
<dl class="field-list">
<dt class="field-odd">entry-point-name<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>The name of the role entry point.</p></li>
<li><p>This should be <code class="docutils literal notranslate"><span class="pre">main</span></code> in the case of an unspecified entry point.</p></li>
<li><p>This will be the base name of the tasks file to execute, with no <code class="docutils literal notranslate"><span class="pre">.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> file extension.</p></li>
</ul>
<dl class="field-list">
<dt class="field-odd">short_description<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>A short, one-line description of the entry point. Ideally, it is a phrase and not a sentence.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">short_description</span></code> is displayed by <code class="docutils literal notranslate"><span class="pre">ansible-doc</span> <span class="pre">-t</span> <span class="pre">role</span> <span class="pre">-l</span></code>.</p></li>
<li><p>It also becomes part of the title for the role page in the documentation.</p></li>
<li><p>The short description should always be a string and never a list, and should not end in a period.</p></li>
</ul>
</dd>
<dt class="field-even">description<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p>A longer description that may contain multiple lines.</p></li>
<li><dl class="simple">
<dt>This can be a single string or a list of strings. In case this is a list of strings, every list</dt><dd><p>element is a new paragraph.</p>
</dd>
</dl>
</li>
</ul>
</dd>
<dt class="field-odd">version_added<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>The version of the role when the entrypoint was added.</p></li>
<li><p>This is a string, and not a float, for example, <code class="docutils literal notranslate"><span class="pre">version_added:</span> <span class="pre">'2.1'</span></code>.</p></li>
<li><p>In collections, this must be the collection version the entrypoint was added to. For example, <code class="docutils literal notranslate"><span class="pre">version_added:</span> <span class="pre">1.0.0</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">author<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p>Name of the entry point authors.</p></li>
<li><p>This can be a single string or a list of strings. Use one list entry per author.
If there is only a single author, use a string or a one-element list.</p></li>
</ul>
</dd>
<dt class="field-odd">options<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>Options are often called “parameters” or “arguments”. This section defines those options.</p></li>
<li><p>For each role option (argument), you may include:</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">option-name<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>The name of the option/argument.</p></li>
</ul>
</dd>
<dt class="field-even">description<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p>Detailed explanation of what this option does. It should be written in full sentences.</p></li>
<li><p>This can be a single string or a list of strings. In case this is a list of strings, every list
element is a new paragraph.</p></li>
</ul>
</dd>
<dt class="field-odd">version_added<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>Only needed if this option was added after the initial role/entry point release. In other words, this is greater than the top level <code class="docutils literal notranslate"><span class="pre">version_added</span></code> field.</p></li>
<li><p>This is a string, and not a float, for example, <code class="docutils literal notranslate"><span class="pre">version_added:</span> <span class="pre">'2.1'</span></code>.</p></li>
<li><p>In collections, this must be the collection version the option was added to. For example, <code class="docutils literal notranslate"><span class="pre">version_added:</span> <span class="pre">1.0.0</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">type<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p>The data type of the option. See <a class="reference internal" href="../dev_guide/developing_program_flow_modules.html#argument-spec"><span class="std std-ref">Argument spec</span></a> for allowed values for <code class="docutils literal notranslate"><span class="pre">type</span></code>. The default is <code class="docutils literal notranslate"><span class="pre">str</span></code>.</p></li>
<li><p>If an option is of type <code class="docutils literal notranslate"><span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">elements</span></code> should be specified.</p></li>
</ul>
</dd>
<dt class="field-odd">required<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>Only needed if <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
<li><p>If missing, the option is not required.</p></li>
</ul>
</dd>
<dt class="field-even">default<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">required</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code>/missing, <code class="docutils literal notranslate"><span class="pre">default</span></code> may be specified (assumed <code class="docutils literal notranslate"><span class="pre">null</span></code> if missing).</p></li>
<li><p>Ensure that the default value in the docs matches the default value in the code. The actual
default for the role variable will always come from the role defaults (as defined in <a class="reference internal" href="#role-directory-structure"><span class="std std-ref">Role directory structure</span></a>).</p></li>
<li><p>The default field must not be listed as part of the description unless it requires additional information or conditions.</p></li>
<li><p>If the option is a boolean value, you should use <code class="docutils literal notranslate"><span class="pre">true</span></code>/<code class="docutils literal notranslate"><span class="pre">false</span></code> if you want to be compatible with <code class="docutils literal notranslate"><span class="pre">ansible-lint</span></code>.</p></li>
</ul>
</dd>
<dt class="field-odd">choices<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>List of option values.</p></li>
<li><p>Should be absent if empty.</p></li>
</ul>
</dd>
<dt class="field-even">elements<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p>Specifies the data type for list elements when the type is <code class="docutils literal notranslate"><span class="pre">list</span></code>.</p></li>
</ul>
</dd>
<dt class="field-odd">options<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>If this option takes a dict or list of dicts, you can define the structure here.</p></li>
</ul>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</section>
<section id="sample-specification">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Sample specification</a><a class="headerlink" href="#sample-specification" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># roles/myapp/meta/argument_specs.yml</span>
<span class="nn">---</span>
<span class="nt">argument_specs</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># roles/myapp/tasks/main.yml entry point</span>
<span class="w">  </span><span class="nt">main</span><span class="p">:</span>
<span class="w">    </span><span class="nt">short_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Main entry point for the myapp role</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This is the main entrypoint for the C(myapp) role.</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Here we can describe what this entrypoint does in lengthy words.</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Every new list item is a new paragraph. You can have multiple sentences</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">per paragraph.</span>
<span class="w">    </span><span class="nt">author</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Daniel Ziegenberg</span>
<span class="w">    </span><span class="nt">options</span><span class="p">:</span>
<span class="w">      </span><span class="nt">myapp_int</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;int&quot;</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;The</span><span class="nv"> </span><span class="s">integer</span><span class="nv"> </span><span class="s">value,</span><span class="nv"> </span><span class="s">defaulting</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">42.&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">second</span><span class="nv"> </span><span class="s">paragraph.&quot;</span>

<span class="w">      </span><span class="nt">myapp_str</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;str&quot;</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">value&quot;</span>

<span class="w">      </span><span class="nt">myapp_list</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;list&quot;</span>
<span class="w">        </span><span class="nt">elements</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;str&quot;</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;A</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">values.&quot;</span>
<span class="w">        </span><span class="nt">version_added</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.3.0</span>

<span class="w">      </span><span class="nt">myapp_list_with_dicts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;list&quot;</span>
<span class="w">        </span><span class="nt">elements</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dict&quot;</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">myapp_food_kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;meat&quot;</span>
<span class="w">            </span><span class="nt">myapp_food_boiling_required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">            </span><span class="nt">myapp_food_preparation_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">myapp_food_kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fruits&quot;</span>
<span class="w">            </span><span class="nt">myapp_food_preparation_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;A</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">dicts</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">defined</span><span class="nv"> </span><span class="s">structure</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">default</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">value.&quot;</span>
<span class="w">        </span><span class="nt">options</span><span class="p">:</span>
<span class="w">          </span><span class="nt">myapp_food_kind</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;str&quot;</span>
<span class="w">            </span><span class="nt">choices</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;vegetables&quot;</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;fruits&quot;</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;grains&quot;</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;meat&quot;</span>
<span class="w">            </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;A</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">limited</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">allowed</span><span class="nv"> </span><span class="s">choices.&quot;</span>

<span class="w">          </span><span class="nt">myapp_food_boiling_required</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bool&quot;</span>
<span class="w">            </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">            </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Whether</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">kind</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">food</span><span class="nv"> </span><span class="s">requires</span><span class="nv"> </span><span class="s">boiling</span><span class="nv"> </span><span class="s">before</span><span class="nv"> </span><span class="s">consumption.&quot;</span>

<span class="w">          </span><span class="nt">myapp_food_preparation_time</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span>
<span class="w">            </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Time</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">prepare</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">dish</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">minutes.&quot;</span>

<span class="w">      </span><span class="nt">myapp_dict_with_suboptions</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dict&quot;</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span>
<span class="w">          </span><span class="nt">myapp_host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bar.foo&quot;</span>
<span class="w">          </span><span class="nt">myapp_exclude_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">          </span><span class="nt">myapp_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/myapp&quot;</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;A</span><span class="nv"> </span><span class="s">dict</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">defined</span><span class="nv"> </span><span class="s">structure</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">default</span><span class="nv"> </span><span class="s">values.&quot;</span>
<span class="w">        </span><span class="nt">options</span><span class="p">:</span>
<span class="w">          </span><span class="nt">myapp_host</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;str&quot;</span>
<span class="w">            </span><span class="nt">choices</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;foo.bar&quot;</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bar.foo&quot;</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ansible.foo.bar&quot;</span>
<span class="w">            </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;A</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">limited</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">allowed</span><span class="nv"> </span><span class="s">choices.&quot;</span>

<span class="w">          </span><span class="nt">myapp_exclude_host</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bool&quot;</span>
<span class="w">            </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;A</span><span class="nv"> </span><span class="s">boolean</span><span class="nv"> </span><span class="s">value.&quot;</span>

<span class="w">          </span><span class="nt">myapp_path</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;path&quot;</span>
<span class="w">            </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;A</span><span class="nv"> </span><span class="s">path</span><span class="nv"> </span><span class="s">value.&quot;</span>

<span class="w">          </span><span class="nt">original_name</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">list</span>
<span class="w">            </span><span class="nt">elements</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;str&quot;</span>
<span class="w">            </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;An</span><span class="nv"> </span><span class="s">optional</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">values.&quot;</span>

<span class="w">  </span><span class="c1"># roles/myapp/tasks/alternate.yml entry point</span>
<span class="w">  </span><span class="nt">alternate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">short_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Alternate entry point for the myapp role</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This is the alternate entrypoint for the C(myapp) role.</span>
<span class="w">    </span><span class="nt">version_added</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.0</span>
<span class="w">    </span><span class="nt">options</span><span class="p">:</span>
<span class="w">      </span><span class="nt">myapp_int</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;int&quot;</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The</span><span class="nv"> </span><span class="s">integer</span><span class="nv"> </span><span class="s">value,</span><span class="nv"> </span><span class="s">defaulting</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">1024.&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="running-a-role-multiple-times-in-one-play">
<span id="run-role-twice"></span><h2><a class="toc-backref" href="#id12" role="doc-backlink">Running a role multiple times in one play</a><a class="headerlink" href="#running-a-role-multiple-times-in-one-play" title="Link to this heading"></a></h2>
<p>Ansible only executes each role once in a play, even if you define it multiple times unless the parameters defined on the role are different for each definition. For example, Ansible only runs the role <code class="docutils literal notranslate"><span class="pre">foo</span></code> once in a play like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
</pre></div>
</div>
<p>You have two options to force Ansible to run a role more than once.</p>
<section id="passing-different-parameters">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Passing different parameters</a><a class="headerlink" href="#passing-different-parameters" title="Link to this heading"></a></h3>
<p>If you pass different parameters in each role definition, Ansible runs the role more than once. Providing different variable values is not the same as passing different role parameters. You must use the <code class="docutils literal notranslate"><span class="pre">roles</span></code> keyword for this behavior, since <code class="docutils literal notranslate"><span class="pre">import_role</span></code> and <code class="docutils literal notranslate"><span class="pre">include_role</span></code> do not accept role parameters.</p>
<p>This play runs the <code class="docutils literal notranslate"><span class="pre">foo</span></code> role twice:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> role</span><span class="p">:</span><span class="w"> </span><span class="nv">foo</span><span class="p p-Indicator">,</span><span class="nt"> message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;first&quot;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> role</span><span class="p">:</span><span class="w"> </span><span class="nv">foo</span><span class="p p-Indicator">,</span><span class="nt"> message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;second&quot;</span><span class="w"> </span><span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>This syntax also runs the <code class="docutils literal notranslate"><span class="pre">foo</span></code> role twice;</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;first&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;second&quot;</span>
</pre></div>
</div>
<p>In these examples, Ansible runs <code class="docutils literal notranslate"><span class="pre">foo</span></code> twice because each role definition has different parameters.</p>
</section>
<section id="using-allow-duplicates-true">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Using <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code></a><a class="headerlink" href="#using-allow-duplicates-true" title="Link to this heading"></a></h3>
<p>Add <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code> to the <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> file for the role:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># playbook.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>

<span class="c1"># roles/foo/meta/main.yml</span>
<span class="nn">---</span>
<span class="nt">allow_duplicates</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>In this example, Ansible runs <code class="docutils literal notranslate"><span class="pre">foo</span></code> twice because we have explicitly enabled it to do so.</p>
</section>
</section>
<section id="using-role-dependencies">
<span id="role-dependencies"></span><h2><a class="toc-backref" href="#id15" role="doc-backlink">Using role dependencies</a><a class="headerlink" href="#using-role-dependencies" title="Link to this heading"></a></h2>
<p>Role dependencies let you automatically pull in other roles when using a role.</p>
<p>Role dependencies are prerequisites, not true dependencies. The roles do not have a parent/child relationship. Ansible loads all listed roles, runs the roles listed under <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> first, then runs the role that lists them. The play object is the parent of all roles, including roles called by a <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> list.</p>
<p>Role dependencies are stored in the <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> file within the role directory. This file should contain a list of roles and parameters to insert before the specified role. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># roles/myapp/meta/main.yml</span>
<span class="nn">---</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common</span>
<span class="w">    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">some_parameter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache</span>
<span class="w">    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">apache_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">dbname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">blarg</span>
<span class="w">      </span><span class="nt">other_parameter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span>
</pre></div>
</div>
<p>Ansible always executes roles listed in <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> before the role that lists them. Ansible executes this pattern recursively when you use the <code class="docutils literal notranslate"><span class="pre">roles</span></code> keyword. For example, if you list role <code class="docutils literal notranslate"><span class="pre">foo</span></code> under <code class="docutils literal notranslate"><span class="pre">roles:</span></code>, role <code class="docutils literal notranslate"><span class="pre">foo</span></code> lists role <code class="docutils literal notranslate"><span class="pre">bar</span></code> under <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> in its meta/main.yml file, and role <code class="docutils literal notranslate"><span class="pre">bar</span></code> lists role <code class="docutils literal notranslate"><span class="pre">baz</span></code> under <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> in its meta/main.yml, Ansible executes <code class="docutils literal notranslate"><span class="pre">baz</span></code>, then <code class="docutils literal notranslate"><span class="pre">bar</span></code>, then <code class="docutils literal notranslate"><span class="pre">foo</span></code>.</p>
<section id="running-role-dependencies-multiple-times-in-one-play">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Running role dependencies multiple times in one play</a><a class="headerlink" href="#running-role-dependencies-multiple-times-in-one-play" title="Link to this heading"></a></h3>
<p>Ansible treats duplicate role dependencies like duplicate roles listed under <code class="docutils literal notranslate"><span class="pre">roles:</span></code>: Ansible only executes role dependencies once, even if defined multiple times, unless the parameters, tags, or when clause defined on the role are different for each definition. If two roles in a play both list a third role as a dependency, Ansible only runs that role dependency once, unless you pass different parameters, tags, when clause, or use <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code> in the role you want to run multiple times. See <a class="reference internal" href="../galaxy/user_guide.html#galaxy-dependencies"><span class="std std-ref">Galaxy role dependencies</span></a> for more details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Role deduplication does not consult the invocation signature of parent roles. Additionally, when using <code class="docutils literal notranslate"><span class="pre">vars:</span></code> instead of role params, there is a side effect of changing variable scoping. Using <code class="docutils literal notranslate"><span class="pre">vars:</span></code> results in those variables being scoped at the play level. In the below example, using <code class="docutils literal notranslate"><span class="pre">vars:</span></code> would cause <code class="docutils literal notranslate"><span class="pre">n</span></code> to be defined as <code class="docutils literal notranslate"><span class="pre">4</span></code> throughout the entire play, including roles called before it.</p>
<p>In addition to the above, users should be aware that role de-duplication occurs before variable evaluation. This means that <a class="reference internal" href="../reference_appendices/glossary.html#term-Lazy-Evaluation"><span class="xref std std-term">Lazy Evaluation</span></a> may make seemingly different role invocations equivalently the same, preventing the role from running more than once.</p>
</div>
<p>For example, a role named <code class="docutils literal notranslate"><span class="pre">car</span></code> depends on a role named <code class="docutils literal notranslate"><span class="pre">wheel</span></code> as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wheel</span>
<span class="w">    </span><span class="nt">n</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wheel</span>
<span class="w">    </span><span class="nt">n</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wheel</span>
<span class="w">    </span><span class="nt">n</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wheel</span>
<span class="w">    </span><span class="nt">n</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</pre></div>
</div>
<p>And the <code class="docutils literal notranslate"><span class="pre">wheel</span></code> role depends on two roles: <code class="docutils literal notranslate"><span class="pre">tire</span></code> and <code class="docutils literal notranslate"><span class="pre">brake</span></code>. The <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> for wheel would then contain the following:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tire</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">brake</span>
</pre></div>
</div>
<p>And the <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> for <code class="docutils literal notranslate"><span class="pre">tire</span></code> and <code class="docutils literal notranslate"><span class="pre">brake</span></code> would contain the following:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">allow_duplicates</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>The resulting order of execution would be as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>tire(n=1)
brake(n=1)
wheel(n=1)
tire(n=2)
brake(n=2)
wheel(n=2)
...
car
</pre></div>
</div>
<p>To use <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code> with role dependencies, you must specify it for the role listed under <code class="docutils literal notranslate"><span class="pre">dependencies</span></code>, not for the role that lists it. In the example above, <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code> appears in the <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> of the <code class="docutils literal notranslate"><span class="pre">tire</span></code> and <code class="docutils literal notranslate"><span class="pre">brake</span></code> roles. The <code class="docutils literal notranslate"><span class="pre">wheel</span></code> role does not require <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code>, because each instance defined by <code class="docutils literal notranslate"><span class="pre">car</span></code> uses different parameter values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="playbooks_variables.html#playbooks-variables"><span class="std std-ref">Using Variables</span></a> for details on how Ansible chooses among variable values defined in different places (variable inheritance and scope).
Also, deduplication happens ONLY at the play level, so multiple plays in the same playbook may rerun the roles.</p>
</div>
</section>
</section>
<section id="embedding-modules-and-plugins-in-roles">
<span id="id2"></span><h2><a class="toc-backref" href="#id17" role="doc-backlink">Embedding modules and plugins in roles</a><a class="headerlink" href="#embedding-modules-and-plugins-in-roles" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This applies only to standalone roles. Roles in collections do not support plugin embedding; they must use the collection’s <code class="docutils literal notranslate"><span class="pre">plugins</span></code> structure to distribute plugins.</p>
</div>
<p>If you write a custom module (see <a class="reference internal" href="../dev_guide/developing_modules.html#developing-modules"><span class="std std-ref">Should you develop a module?</span></a>) or a plugin (see <a class="reference internal" href="../dev_guide/developing_plugins.html#developing-plugins"><span class="std std-ref">Developing plugins</span></a>), you might wish to distribute it as part of a role. For example, if you write a module that helps configure your company’s internal software, and you want other people in your organization to use this module, but do not want to tell everyone how to configure their Ansible library path, you can include the module in your internal_config role.</p>
<p>To add a module or a plugin to a role:
Alongside the ‘tasks’ and ‘handlers’ structure of a role, add a directory named ‘library’ and then include the module directly inside the ‘library’ directory.</p>
<p>Assuming you had this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>roles/
    my_custom_modules/
        library/
            module1
            module2
</pre></div>
</div>
<p>The module will be usable in the role itself, as well as any roles that are called <em>after</em> this role, as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_custom_modules</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">some_other_role_using_my_custom_modules</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yet_another_role_using_my_custom_modules</span>
</pre></div>
</div>
<p>If necessary, you can also embed a module in a role to modify a module in Ansible’s core distribution. For example, you can use the development version of a particular module before it is released in production releases by copying the module and embedding the copy in a role. Use this approach with caution, as API signatures may change in core components, and this workaround is not guaranteed to work.</p>
<p>The same mechanism can be used to embed and distribute plugins in a role, using the same schema. For example, for a filter plugin:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>roles/
    my_custom_filter/
        filter_plugins
            filter1
            filter2
</pre></div>
</div>
<p>These filters can then be used in a Jinja template in any role called after ‘my_custom_filter’.</p>
</section>
<section id="sharing-roles-ansible-galaxy">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Sharing roles: Ansible Galaxy</a><a class="headerlink" href="#sharing-roles-ansible-galaxy" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://galaxy.ansible.com">Ansible Galaxy</a> is a free site for finding, downloading, rating, and reviewing all kinds of community-developed Ansible roles and can be a great way to get a jumpstart on your automation projects.</p>
<p>The client <code class="docutils literal notranslate"><span class="pre">ansible-galaxy</span></code> is included in Ansible. The Galaxy client allows you to download roles from Ansible Galaxy and provides an excellent default framework for creating your own roles.</p>
<p>Read the <a class="reference external" href="https://ansible.readthedocs.io/projects/galaxy-ng/en/latest/">Ansible Galaxy documentation</a> page for more information.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="../galaxy/user_guide.html#ansible-galaxy"><span class="std std-ref">Galaxy User Guide</span></a></dt><dd><p>How to create new roles, share roles on Galaxy, role management</p>
</dd>
<dt><a class="reference internal" href="../reference_appendices/YAMLSyntax.html#yaml-syntax"><span class="std std-ref">YAML Syntax</span></a></dt><dd><p>Learn about YAML syntax</p>
</dd>
<dt><a class="reference internal" href="playbooks.html#working-with-playbooks"><span class="std std-ref">Working with playbooks</span></a></dt><dd><p>Review the basic Playbook language features</p>
</dd>
<dt><a class="reference internal" href="../tips_tricks/ansible_tips_tricks.html#tips-and-tricks"><span class="std std-ref">General tips</span></a></dt><dd><p>Tips and tricks for playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_variables.html#playbooks-variables"><span class="std std-ref">Using Variables</span></a></dt><dd><p>Variables in playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_conditionals.html#playbooks-conditionals"><span class="std std-ref">Conditionals</span></a></dt><dd><p>Conditionals in playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_loops.html#playbooks-loops"><span class="std std-ref">Loops</span></a></dt><dd><p>Loops in playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_tags.html#tags"><span class="std std-ref">Tags</span></a></dt><dd><p>Using tags to select or skip roles/tasks in long playbooks</p>
</dd>
<dt><a class="reference internal" href="../collections/index.html#list-of-collections"><span class="std std-ref">Collection Index</span></a></dt><dd><p>Browse existing collections, modules, and plugins</p>
</dd>
<dt><a class="reference internal" href="../dev_guide/developing_modules.html#developing-modules"><span class="std std-ref">Should you develop a module?</span></a></dt><dd><p>Extending Ansible by writing your own modules</p>
</dd>
<dt><a class="reference external" href="https://github.com/ansible/ansible-examples">GitHub Ansible examples</a></dt><dd><p>Complete playbook files from the GitHub project source</p>
</dd>
<dt><a class="reference external" href="https://groups.google.com/group/ansible-project">Mailing List</a></dt><dd><p>Questions? Help? Ideas?  Stop by the list on Google Groups</p>
</dd>
</dl>
</div>
</section>
</section>


           </div>
          </div>
          

<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="playbooks_reuse.html" class="btn btn-neutral float-left" title="Re-using Ansible artifacts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="playbooks_module_defaults.html" class="btn btn-neutral float-right" title="Module defaults" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ansible project contributors.
      <span class="lastupdated">Last updated on Jun 13, 2024.
      </span></p>
  </div>

  
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script><!-- extra footer elements for Ansible beyond RTD Sphinx Theme -->
<!-- begin analytics -->
<script>
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = 'https://js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script>
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script>

</body>
</html>